name: Report Generator

on:
  workflow_call:
    inputs:
      test_type:
        required: true
        type: string
      test_suite:
        required: true
        type: string
      browser:
        required: true
        type: string
      environment:
        required: true
        type: string
      priority:
        required: true
        type: string
      run_id:
        required: true
        type: string
      total_tests:
        required: false
        type: number
        default: 0
      passed_tests:
        required: false
        type: number
        default: 0
      failed_tests:
        required: false
        type: number
        default: 0
      skipped_tests:
        required: false
        type: number
        default: 0
      duration:
        required: false
        type: number
        default: 0
      success_rate:
        required: false
        type: number
        default: 0
      exit_code:
        required: false
        type: number
        default: 0

jobs:
  generate_reports:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ðŸ“Š Create Report Summary
        run: |
          echo "ðŸ“ˆ ========================================="
          echo "ðŸ“ˆ   TEST EXECUTION REPORT"
          echo "ðŸ“ˆ ========================================="
          echo "ðŸ†” Run ID: ${{ inputs.run_id }}"
          echo "ðŸŽ¯ Test Type: ${{ inputs.test_type }}"
          echo "ðŸ“‚ Test Suite: ${{ inputs.test_suite }}"
          echo "ðŸŒ Browser: ${{ inputs.browser }}"
          echo "ðŸ¢ Environment: ${{ inputs.environment }}"
          echo "ðŸŽ¯ Priority: ${{ inputs.priority }}"
          echo "ðŸ“Š Total Tests: ${{ inputs.total_tests }}"
          echo "âœ… Passed Tests: ${{ inputs.passed_tests }}"
          echo "âŒ Failed Tests: ${{ inputs.failed_tests }}"
          echo "â­ï¸  Skipped Tests: ${{ inputs.skipped_tests }}"
          echo "ðŸ“ˆ Success Rate: ${{ inputs.success_rate }}%"
          echo "â±ï¸  Duration: ${{ inputs.duration }} seconds"
          echo "ðŸ”š Exit Code: ${{ inputs.exit_code }}"
          echo "ðŸ“ˆ ========================================="
      
      - name: ðŸ“ Create Report Directory
        run: |
          mkdir -p ./reports/${{ inputs.run_id }}
          echo "# Test Report for ${{ inputs.run_id }}" > ./reports/${{ inputs.run_id }}/report.md
          echo "" >> ./reports/${{ inputs.run_id }}/report.md
          echo "## Test Details" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Test Type:** ${{ inputs.test_type }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Test Suite:** ${{ inputs.test_suite }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Browser:** ${{ inputs.browser }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Environment:** ${{ inputs.environment }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Priority:** ${{ inputs.priority }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "" >> ./reports/${{ inputs.run_id }}/report.md
          echo "## Results" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Total Tests:** ${{ inputs.total_tests }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Passed:** ${{ inputs.passed_tests }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Failed:** ${{ inputs.failed_tests }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Skipped:** ${{ inputs.skipped_tests }}" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Success Rate:** ${{ inputs.success_rate }}%" >> ./reports/${{ inputs.run_id }}/report.md
          echo "- **Duration:** ${{ inputs.duration }} seconds" >> ./reports/${{ inputs.run_id }}/report.md
          echo "" >> ./reports/${{ inputs.run_id }}/report.md
          echo "*Report generated on $(date)*" >> ./reports/${{ inputs.run_id }}/report.md
          
          echo "âœ… Report directory created"
      
      - name: ðŸ“¤ Upload Report Artifact
        uses: actions/upload-artifact@v4
        with:
          name: test-report-${{ inputs.run_id }}
          path: ./reports/${{ inputs.run_id }}
          retention-days: 7
      
      - name: ðŸ“¢ Create GitHub Summary
        run: |
          echo "## ðŸŽ‰ Test Execution Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‹ Test Run Details" >> $GITHUB_STEP_SUMMARY
          echo "- **Run ID:** ${{ inputs.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Test Type:** ${{ inputs.test_type }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Test Suite:** ${{ inputs.test_suite }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Browser:** ${{ inputs.browser }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Environment:** ${{ inputs.environment }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Duration:** ${{ inputs.duration }} seconds" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Test Results" >> $GITHUB_STEP_SUMMARY
          echo "- **Total Tests:** ${{ inputs.total_tests }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Passed:** ${{ inputs.passed_tests }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Failed:** ${{ inputs.failed_tests }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Skipped:** ${{ inputs.skipped_tests }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Success Rate:** ${{ inputs.success_rate }}%" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ Download Reports" >> $GITHUB_STEP_SUMMARY
          echo "Download the `test-report-${{ inputs.run_id }}` artifact for detailed results." >> $GITHUB_STEP_SUMMARY
