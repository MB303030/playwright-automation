name: Report Generator

on:
  workflow_call:
    inputs:
      test_type:
        required: true
        type: string
      test_suite:
        required: true
        type: string
      browser:
        required: true
        type: string
      environment:
        required: true
        type: string
      priority:
        required: true
        type: string
      run_id:
        required: true
        type: string

jobs:
  generate_reports:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Download Playwright HTML Report
        uses: actions/download-artifact@v4
        with:
          name: playwright-html-report-${{ inputs.run_id }}
          path: ./downloaded-report
        continue-on-error: true
      
      - name: ğŸ“¥ Download Test Results
        uses: actions/download-artifact@v4
        with:
          name: test-results-${{ inputs.run_id }}
          path: ./downloaded-results
        continue-on-error: true
      
      - name: ğŸ“Š Create GitHub Summary
        run: |
          echo "## ğŸ§ª Playwright Test Execution" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Run ID:** ${{ inputs.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "**Test Type:** ${{ inputs.test_type }}" >> $GITHUB_STEP_SUMMARY
          echo "**Test Suite:** ${{ inputs.test_suite }}" >> $GITHUB_STEP_SUMMARY
          echo "**Browser:** ${{ inputs.browser }}" >> $GITHUB_STEP_SUMMARY
          echo "**Environment:** ${{ inputs.environment }}" >> $GITHUB_STEP_SUMMARY
          echo "**Priority:** ${{ inputs.priority }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -d "./downloaded-report" ]; then
            echo "âœ… **Playwright HTML Report is available**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Download the **playwright-html-report-${{ inputs.run_id }}** artifact to view the full interactive report." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "To view the report:" >> $GITHUB_STEP_SUMMARY
            echo "1. Download the artifact" >> $GITHUB_STEP_SUMMARY
            echo "2. Extract the files" >> $GITHUB_STEP_SUMMARY
            echo "3. Open `index.html` in a web browser" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **No Playwright HTML report found**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "The test execution might have failed before generating a report." >> $GITHUB_STEP_SUMMARY
          fi
      
      - name: ğŸ“‹ Create Simple Summary
        run: |
          echo "Test Execution Summary" > summary.txt
          echo "=====================" >> summary.txt
          echo "" >> summary.txt
          echo "Run ID: ${{ inputs.run_id }}" >> summary.txt
          echo "Type: ${{ inputs.test_type }}" >> summary.txt
          echo "Suite: ${{ inputs.test_suite }}" >> summary.txt
          echo "Browser: ${{ inputs.browser }}" >> summary.txt
          echo "Environment: ${{ inputs.environment }}" >> summary.txt
          echo "" >> summary.txt
          echo "Report: Download the 'playwright-html-report-${{ inputs.run_id }}' artifact" >> summary.txt
          
          mkdir -p ./reports/${{ inputs.run_id }}
          cp summary.txt ./reports/${{ inputs.run_id }}/
      
      - name: ğŸ“¤ Upload Summary
        uses: actions/upload-artifact@v4
        with:
          name: report-summary-${{ inputs.run_id }}
          path: ./reports/${{ inputs.run_id }}
          retention-days: 30
