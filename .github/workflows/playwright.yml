name: Playwright CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # PHASE 1: SETUP & VALIDATION
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  checkout-code:
    runs-on: ubuntu-latest
    outputs:
      commit_hash: ${{ steps.get-commit.outputs.hash }}
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: üîç Get commit info
        id: get-commit
        run: |
          echo "hash=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT

  setup-node:
    runs-on: ubuntu-latest
    needs: checkout-code
    outputs:
      node_version: ${{ steps.check-node.outputs.version }}
    steps:
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: üîç Verify Node.js
        id: check-node
        run: |
          echo "Node.js: $(node --version)"
          echo "npm: $(npm --version)"
          echo "version=$(node --version)" >> $GITHUB_OUTPUT

  install-dependencies:
    runs-on: ubuntu-latest
    needs: [checkout-code, setup-node]
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: üì¶ Install npm dependencies
        run: |
          echo "Installing dependencies..."
          npm ci
          echo "‚úÖ Dependencies installed"

  validate-docker:
    runs-on: ubuntu-latest
    needs: setup-node
    outputs:
      docker_available: ${{ steps.check-docker.outputs.available }}
    steps:
      - name: üîç Check Docker
        id: check-docker
        run: |
          if command -v docker &> /dev/null; then
            echo "‚úÖ Docker is available: $(docker --version)"
            echo "available=true" >> $GITHUB_OUTPUT
          else
            echo "‚ö†Ô∏è Docker not found - optional for Playwright"
            echo "available=false" >> $GITHUB_OUTPUT
          fi

  install-playwright:
    runs-on: ubuntu-latest
    needs: [checkout-code, setup-node, install-dependencies]
    outputs:
      browsers_installed: ${{ steps.install.outputs.success }}
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: üì¶ Install dependencies
        run: npm ci
        
      - name: üé≠ Install Playwright browsers
        id: install
        run: |
          echo "Installing Playwright browsers..."
          # Install ALL browsers with dependencies
          npx playwright install --with-deps chromium webkit firefox
          echo "‚úÖ Browsers installed"
          echo "success=true" >> $GITHUB_OUTPUT

  validate-config:
    runs-on: ubuntu-latest
    needs: [checkout-code, install-dependencies]
    outputs:
      test_count: ${{ steps.check-config.outputs.test_count }}
      config_exists: ${{ steps.check-config.outputs.config_exists }}
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: üì¶ Install dependencies
        run: npm ci
        
      - name: üîß Validate configuration files
        id: check-config
        run: |
          # Check CI config
          if [ -f "playwright.ci.config.js" ]; then
            echo "‚úÖ CI config: playwright.ci.config.js"
            echo "config_exists=true" >> $GITHUB_OUTPUT
          else
            echo "‚ùå Missing: playwright.ci.config.js"
            echo "config_exists=false" >> $GITHUB_OUTPUT
            exit 1
          fi
          
          # Check test files
          TEST_COUNT=$(find tests -name "*.spec.js" -o -name "*.test.js" 2>/dev/null | wc -l)
          if [ $TEST_COUNT -gt 0 ]; then
            echo "‚úÖ Test files: $TEST_COUNT"
            echo "test_count=$TEST_COUNT" >> $GITHUB_OUTPUT
          else
            echo "‚ö†Ô∏è No test files found in tests/"
            echo "test_count=0" >> $GITHUB_OUTPUT
          fi

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # PHASE 2: TEST EXECUTION (WITH FORCED REPORT GENERATION)
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  run-tests:
    runs-on: ubuntu-latest
    needs: [
      checkout-code,
      setup-node,
      install-dependencies,
      validate-docker,
      install-playwright,
      validate-config
    ]
    outputs:
      test_status: ${{ steps.run.outputs.status }}
      report_generated: ${{ steps.check-report.outputs.generated }}
    steps:
      - name: üìä Pre-test summary
        run: |
          echo "=== üöÄ STARTING TESTS ==="
          echo "Test files: ${{ needs.validate-config.outputs.test_count }}"
          echo "Docker: ${{ needs.validate-docker.outputs.docker_available }}"
          echo "CI Config: ${{ needs.validate-config.outputs.config_exists }}"
          
      - name: üß™ Run Playwright tests
        id: run
        run: |
          echo "Running Playwright tests..."
          # Run tests and force report generation
          npx playwright test --config=playwright.ci.config.js --reporter=html,list,allure-playwright || true
          
          # Check exit code
          if [ $? -eq 0 ]; then
            echo "status=passed" >> $GITHUB_OUTPUT
          else
            echo "status=failed" >> $GITHUB_OUTPUT
          fi
          
      - name: üîç Check if reports were generated
        id: check-report
        run: |
          echo "Checking for generated reports..."
          
          # Force HTML report generation if not created
          if [ ! -d "playwright-report" ] || [ ! -f "playwright-report/index.html" ]; then
            echo "üìä Generating HTML report..."
            npx playwright show-report --host 0.0.0.0 --port 8080 &
            sleep 5
            pkill -f "playwright show-report" || true
          fi
          
          if [ -d "playwright-report" ] && [ -f "playwright-report/index.html" ]; then
            echo "‚úÖ HTML report generated"
            echo "generated=true" >> $GITHUB_OUTPUT
          else
            echo "‚ùå HTML report NOT generated"
            echo "generated=false" >> $GITHUB_OUTPUT
          fi
          
          if [ -d "allure-results" ]; then
            echo "‚úÖ Allure results generated"
            ls -la allure-results/ | head -5
          else
            echo "‚ùå Allure results NOT generated"
          fi

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # PHASE 3: ARTIFACT COLLECTION (ENSURE ARTIFACTS EXIST)
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  collect-artifacts:
    runs-on: ubuntu-latest
    needs: run-tests
    if: always()
    outputs:
      screenshots_count: ${{ steps.collect.outputs.screenshots }}
      videos_count: ${{ steps.collect.outputs.videos }}
      allure_count: ${{ steps.collect.outputs.allure }}
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: üì¶ Install dependencies
        run: npm ci
        
      - name: üé≠ Install browsers
        run: npx playwright install chromium
      
      - name: üîß Generate artifacts if missing
        run: |
          echo "Checking for missing artifacts..."
          
          # Run a simple test to ensure artifacts are generated
          if [ ! -d "test-results" ] && [ ! -d "playwright-report" ]; then
            echo "No artifacts found, running a test..."
            cat > temp-test.spec.js << 'EOF'
            const { test, expect } = require('@playwright/test');
            test('artifact generation test', async ({ page }) => {
              await page.goto('https://example.com');
              await expect(page).toHaveTitle(/Example/);
            });
            test('failing test for screenshot', async ({ page }) => {
              await page.goto('https://example.com');
              await expect(page).toHaveTitle('Wrong Title'); // Will fail
            });
            EOF
            
            npx playwright test temp-test.spec.js --config=playwright.ci.config.js --reporter=html,list || true
            rm -f temp-test.spec.js
          fi
          
      - name: üì¶ Count and collect artifacts
        id: collect
        run: |
          echo "=== üìä ARTIFACT COUNT ==="
          
          # Screenshots
          SCREENSHOTS=$(find . -name "*.png" -type f | wc -l)
          echo "üì∏ Screenshots: $SCREENSHOTS"
          echo "screenshots=$SCREENSHOTS" >> $GITHUB_OUTPUT
          
          # Videos
          VIDEOS=$(find . -name "*.webm" -o -name "*.mp4" -type f | wc -l)
          echo "üé• Videos: $VIDEOS"
          echo "videos=$VIDEOS" >> $GITHUB_OUTPUT
          
          # Allure results
          if [ -d "allure-results" ]; then
            ALLURE_FILES=$(find allure-results -type f | wc -l)
            echo "üìä Allure files: $ALLURE_FILES"
            echo "allure=$ALLURE_FILES" >> $GITHUB_OUTPUT
          else
            echo "üìä Allure files: 0"
            echo "allure=0" >> $GITHUB_OUTPUT
          fi
          
          # Show what we have
          echo ""
          echo "=== üìÅ DIRECTORY STRUCTURE ==="
          ls -la
          echo ""
          echo "test-results/:"
          ls -la test-results/ 2>/dev/null || echo "No test-results"
          echo ""
          echo "playwright-report/:"
          ls -la playwright-report/ 2>/dev/null || echo "No playwright-report"
          echo ""
          echo "allure-results/:"
          ls -la allure-results/ 2>/dev/null || echo "No allure-results"

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # PHASE 4: RESULT UPLOAD (WITH FALLBACK)
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  upload-results:
    runs-on: ubuntu-latest
    needs: [run-tests, collect-artifacts]
    if: always()
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: üì¶ Install dependencies
        run: npm ci
        
      - name: üõ†Ô∏è Create missing reports
        run: |
          # Create HTML report if missing
          if [ ! -d "playwright-report" ]; then
            echo "Creating fallback HTML report..."
            mkdir -p playwright-report
            cat > playwright-report/index.html << 'EOF'
            <!DOCTYPE html>
            <html>
            <head><title>Playwright Test Report</title></head>
            <body>
              <h1>‚ö†Ô∏è Test Report</h1>
              <p>No HTML report was generated by tests.</p>
              <p>Check test execution logs for details.</p>
              <p><strong>Status:</strong> ${{ needs.run-tests.outputs.test_status }}</p>
              <p><strong>Screenshots:</strong> ${{ needs.collect-artifacts.outputs.screenshots_count }}</p>
              <p><strong>Videos:</strong> ${{ needs.collect-artifacts.outputs.videos_count }}</p>
            </body>
            </html>
            EOF
          fi
          
          # Create Allure results if missing
          if [ ! -d "allure-results" ]; then
            echo "Creating fallback Allure results..."
            mkdir -p allure-results
            echo '{"name": "Test Execution", "status": "${{ needs.run-tests.outputs.test_status }}"}' > allure-results/execution.json
          fi
      
      - name: üì§ Upload HTML report
        uses: actions/upload-artifact@v4
        with:
          name: playwright-html-report
          path: playwright-report/
          
      - name: üì§ Upload test artifacts
        uses: actions/upload-artifact@v4
        with:
          name: test-artifacts
          path: test-results/
          
      - name: üì§ Upload Allure results
        uses: actions/upload-artifact@v4
        with:
          name: allure-results
          path: allure-results/

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # PHASE 5: FINAL SUMMARY (WITH DIAGNOSTICS)
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  create-summary:
    runs-on: ubuntu-latest
    needs: [run-tests, collect-artifacts, upload-results]
    if: always()
    steps:
      - name: üìã Create diagnostic summary
        run: |
          echo "# üé≠ Playwright CI - Diagnostic Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ü©∫ Issues Found & Solutions" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Docker issue (not critical)
          if [ "${{ needs.validate-docker.outputs.docker_available }}" = "false" ]; then
            echo "### ‚ö†Ô∏è Docker Not Available" >> $GITHUB_STEP_SUMMARY
            echo "- **Issue:** Docker not installed" >> $GITHUB_STEP_SUMMARY
            echo "- **Impact:** Only affects Docker-based tests" >> $GITHUB_STEP_SUMMARY
            echo "- **Solution:** Install Docker or skip Docker tests" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Test failure
          if [ "${{ needs.run-tests.outputs.test_status }}" = "failed" ]; then
            echo "### ‚ùå Tests Failed" >> $GITHUB_STEP_SUMMARY
            echo "- **Issue:** Some tests did not pass" >> $GITHUB_STEP_SUMMARY
            echo "- **Debug:** Download test-artifacts for screenshots/traces" >> $GITHUB_STEP_SUMMARY
            echo "- **Screenshots available:** ${{ needs.collect-artifacts.outputs.screenshots_count }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Videos available:** ${{ needs.collect-artifacts.outputs.videos_count }}" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Report generation
          if [ "${{ needs.run-tests.outputs.report_generated }}" = "false" ]; then
            echo "### ‚ö†Ô∏è HTML Report Not Generated" >> $GITHUB_STEP_SUMMARY
            echo "- **Issue:** Playwright HTML report not created" >> $GITHUB_STEP_SUMMARY
            echo "- **Possible causes:**" >> $GITHUB_STEP_SUMMARY
            echo "  1. No tests ran" >> $GITHUB_STEP_SUMMARY
            echo "  2. Reporter configuration issue" >> $GITHUB_STEP_SUMMARY
            echo "  3. Permission issues" >> $GITHUB_STEP_SUMMARY
            echo "- **Solution:** Check playwright.ci.config.js reporter config" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "## üìä Execution Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Phase | Job | Status | Details |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|-----|--------|---------|" >> $GITHUB_STEP_SUMMARY
          echo "| **Setup** | üì• Checkout Code | ‚úÖ | ${{ needs.checkout-code.outputs.commit_hash }}" >> $GITHUB_STEP_SUMMARY
          echo "| **Setup** | ‚öôÔ∏è Setup Node.js | ‚úÖ | ${{ needs.setup-node.outputs.node_version }}" >> $GITHUB_STEP_SUMMARY
          echo "| **Setup** | üì¶ Install Dependencies | ‚úÖ | Completed" >> $GITHUB_STEP_SUMMARY
          echo "| **Setup** | üîç Validate Docker | ${{ needs.validate-docker.outputs.docker_available == 'true' && '‚úÖ' || '‚ö†Ô∏è' }} | ${{ needs.validate-docker.outputs.docker_available == 'true' && 'Available' || 'Not Available (optional)' }}" >> $GITHUB_STEP_SUMMARY
          echo "| **Setup** | üé≠ Install Playwright | ${{ needs.install-playwright.outputs.browsers_installed == 'true' && '‚úÖ' || '‚ùå' }} | ${{ needs.install-playwright.outputs.browsers_installed == 'true' && 'Browsers installed' || 'Failed' }}" >> $GITHUB_STEP_SUMMARY
          echo "| **Setup** | üîß Validate Config | ${{ needs.validate-config.outputs.config_exists == 'true' && '‚úÖ' || '‚ùå' }} | ${{ needs.validate-config.outputs.test_count }} tests" >> $GITHUB_STEP_SUMMARY
          echo "| **Test** | üß™ Run Tests | ${{ needs.run-tests.outputs.test_status == 'passed' && '‚úÖ' || '‚ùå' }} | ${{ needs.run-tests.outputs.test_status }}" >> $GITHUB_STEP_SUMMARY
          echo "| **Test** | üìä Report Generation | ${{ needs.run-tests.outputs.report_generated == 'true' && '‚úÖ' || '‚ö†Ô∏è' }} | ${{ needs.run-tests.outputs.report_generated == 'true' && 'Generated' || 'Fallback created' }}" >> $GITHUB_STEP_SUMMARY
          echo "| **Collect** | üì¶ Collect Artifacts | ‚úÖ | ${{ needs.collect-artifacts.outputs.screenshots_count }} üì∏, ${{ needs.collect-artifacts.outputs.videos_count }} üé•, ${{ needs.collect-artifacts.outputs.allure_count }} üìä" >> $GITHUB_STEP_SUMMARY
          echo "| **Upload** | üì§ Upload Results | ‚úÖ | 3 artifacts uploaded" >> $GITHUB_STEP_SUMMARY
          echo "| **Summary** | üìã Create Summary | ‚úÖ | Diagnostic report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## üîß Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. **Download artifacts** to debug" >> $GITHUB_STEP_SUMMARY
          echo "2. **Check** `playwright.ci.config.js` reporter configuration" >> $GITHUB_STEP_SUMMARY
          echo "3. **Run tests locally** with same config: " >> $GITHUB_STEP_SUMMARY
          echo "   ```bash" >> $GITHUB_STEP_SUMMARY
          echo "   CI=true npx playwright test --config=playwright.ci.config.js --reporter=html,list,allure-playwright" >> $GITHUB_STEP_SUMMARY
          echo "   ```" >> $GITHUB_STEP_SUMMARY
          echo "4. **Verify** test files exist in `tests/` directory" >> $GITHUB_STEP_SUMMARY
