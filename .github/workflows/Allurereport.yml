name: Test Allure MINIMAL

on:
  workflow_dispatch:  # Manual trigger ONLY

jobs:
  test-allure:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“¦ Install Node.js & Allure CLI
        run: |
          npm install -g allure-commandline
          allure --version

      - name: ðŸ§ª Run tests to generate Allure results
        run: |
          # Create a simple test
          cat > test.js << 'EOF'
          const { test, expect } = require('@playwright/test');
          test('test 1', async ({ page }) => {
            await page.goto('https://example.com');
            await expect(page).toHaveTitle('Example Domain');
          });
          EOF
          
          # Run with Allure reporter
          npx playwright test test.js --reporter=allure-playwright

      - name: ðŸ“Š Generate Allure HTML report
        run: |
          echo "Generating Allure HTML..."
          allure generate allure-results -o allure-report --clean
          
          echo "=== Report Status ==="
          if [ -f "allure-report/index.html" ]; then
            echo "âœ… SUCCESS: Allure HTML report created!"
            ls -la allure-report/
          else
            echo "âŒ FAILED: No HTML report"
            ls -la
          fi

      - name: ðŸ“¤ Upload Allure HTML report
        uses: actions/upload-artifact@v4
        with:
          name: allure-html-report
          path: allure-report/

      - name: ðŸ“‹ Show result
        run: |
          echo "## ðŸŽ­ Allure Test Result" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Status: $([ -f 'allure-report/index.html' ] && echo 'âœ… SUCCESS' || echo 'âŒ FAILED')" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Download the 'allure-html-report' artifact" >> $GITHUB_STEP_SUMMARY
          echo "### Extract and open index.html in your browser" >> $GITHUB_STEP_SUMMARY
